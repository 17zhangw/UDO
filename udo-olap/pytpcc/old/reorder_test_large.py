from gym_olapgame.envs import index

from old import order_optimizer

# sf 10
# log = [
#     [20, 15, 59], [1, 58, 44, 52, 49], [47, 46, 28, 43, 36], [37, 13, 47, 33, 19], [22, 42, 33, 35, 58],
#     [23, 11, 56, 38, 9], [7, 25, 54, 42, 32], [8, 37, 9, 28, 56], [32, 38, 27, 20, 36], [42, 10, 28, 59],
#     [52, 17, 6, 32, 10], [46, 50, 17, 29, 49], [2, 0, 30, 11, 36], [3, 5, 14, 28, 18], [30, 36, 8, 29, 4],
#     [16, 22, 11, 15, 56], [19, 34, 14, 18, 50], [21, 53, 38, 29, 13], [34, 54, 15, 5, 0], [55, 14, 42, 21, 18],
#     [56, 41, 24, 53, 17], [38, 6, 17, 43, 18], [10, 5, 0, 4, 31], [35, 33, 57, 6, 9], [43, 26, 33, 58, 32],
#     [26, 25, 12, 19, 53], [24, 43, 46, 45, 7], [17, 16, 43, 26, 3], [27, 57, 44, 33, 31], [45, 2, 11, 19, 22],
#     [39, 20, 27, 21, 58], [11, 49, 52, 58, 18], [9, 19, 37, 47, 45], [0, 54, 14, 29, 22], [51, 23, 50, 42, 52],
#     [36, 22, 25, 9, 19], [40, 17, 18, 48, 0], [53, 55, 11, 27, 42], [4, 58, 34, 17, 2], [29, 16, 23, 40, 58],
#     [57, 14, 22, 46, 34], [15, 1, 28, 57, 35], [6, 50, 30, 54, 8], [5, 31, 27, 42, 18], [58, 49, 23, 31, 35],
#     [48, 13, 8, 11, 23], [41, 6, 42, 3, 40], [54, 39, 32, 37, 23], [14, 4, 35, 19, 26], [18, 55, 42, 43, 10],
#     [25, 15, 39, 13, 19], [13, 40, 7, 35, 48], [59], [49, 1, 6, 53, 2], [33, 34, 41, 49, 25], [12, 8, 57, 20, 2],
#     [44, 54, 38, 34, 5], [31, 26, 24, 0, 11], [50, 43, 14, 40, 25], [28, 7, 53, 19, 45], [5, 18, 42, 19, 47],
#     # [5, 2, 44, 52, 22], [5, 32, 41, 29, 26], [5, 11, 25, 49, 1], [5, 25, 34, 59], [5, 8, 59], [5, 21, 34, 59],
#     # [5, 40, 52, 3, 21], [5, 44, 13, 45, 9], [5, 50, 15, 27, 39], [5, 17, 11, 54, 55], [5, 34, 58, 37, 20],
#     # [5, 15, 40, 57, 25], [5, 49, 15, 47, 45], [5, 0, 2, 26, 47], [5, 16, 17, 21, 1], [5, 6, 48, 31, 42],
#     # [5, 47, 3, 39, 23], [5, 59], [5, 38, 24, 41, 27]
# ]

# another sf 10

log = [
    [43, 15, 31, 51, 53], [3, 57, 47, 2, 4], [2, 19, 10, 42, 41], [37, 24, 49, 22, 0], [29, 4, 33, 26, 12],
    [6, 49, 54, 32, 8], [42, 45, 10, 50, 0], [24, 32, 18, 16, 58], [56, 28, 14, 38, 53], [26, 27, 55, 33, 32],
    [39, 36, 54, 20, 49], [49, 8, 9, 43, 48], [13, 38, 57, 20, 18], [15, 45, 16, 7, 56], [46, 25, 2, 22, 37],
    [40, 2, 57, 53, 22], [31, 35, 16, 43, 29], [28, 32, 27, 34, 18], [16, 36, 18, 20, 9], [10, 13, 22, 45, 51],
    [25, 49, 37, 42, 34], [17, 32, 14, 33, 12], [48, 16, 30, 43, 39], [45, 15, 50, 10, 58], [47, 48, 1, 27, 18],
    [8, 59], [12, 36, 35, 4, 26], [5, 54, 2, 35, 6], [30, 35, 22, 27, 17], [22, 35, 34, 10, 2], [9, 39, 8, 5, 11],
    [57, 46, 49, 15, 42], [59], [38, 46, 18, 10, 40], [7, 37, 12, 27, 59], [33, 16, 8, 7, 52], [36, 10, 11, 4, 59],
    [23, 34, 57, 35, 31], [53, 11, 20, 3, 17], [11, 55, 43, 38, 59], [4, 59], [35, 28, 17, 24, 14], [21, 8, 29, 59],
    [55, 44, 46, 24, 1], [41, 47, 2, 4, 14], [1, 23, 34, 53, 8], [18, 34, 15, 24, 3], [14, 26, 15, 50, 13],
    [51, 36, 5, 22, 49], [0, 11, 3, 5, 26], [58, 56, 12, 0, 34], [50, 1, 5, 30, 12], [52, 12, 49, 41, 36],
    [32, 29, 36, 24, 16], [54, 43, 37, 3, 28], [20, 39, 14, 48, 3], [27, 35, 28, 44, 32], [44, 49, 54, 52, 39],
    [19, 9, 28, 26, 21], [34, 15, 37, 4, 56]
]


# tpch sf10, uncluster indices
# build_time = [111.71922373771667, 68.26275300979614, 68.77195405960083, 21.325596809387207, 86.95721745491028,
#               40.789095878601074, 39.64424419403076, 89.73198342323303, 41.4348886013031, 41.93954658508301,
#               43.67987656593323, 64.78947567939758, 65.47344923019409, 49.863909006118774, 21.263834238052368,
#               37.34047842025757, 22.661657571792603, 36.24306535720825, 111.65465497970581, 5.766031980514526,
#               6.797137022018433, 5.609894275665283, 5.038241863250732, 5.157031059265137, 2.735470771789551,
#               0.05354905128479004, 0.8469641208648682, 2.312934160232544, 1.2908766269683838, 5.611810207366943,
#               1.205336570739746, 2.7677671909332275, 2.90208101272583, 8.16718864440918, 10.27039647102356,
#               5.381924390792847, 5.173318386077881, 5.938763856887817, 9.925728797912598, 15.105897903442383,
#               5.964293479919434, 7.21458101272583, 6.372082948684692, 0.003083467483520508, 0.0027704238891601562,
#               0.0028083324432373047, 0.0029277801513671875, 1.204240083694458, 0.5720212459564209, 1.5201876163482666,
#               1.1892766952514648, 1.0886595249176025, 4.218854904174805, 0.7630765438079834, 3.4531970024108887,
#               0.7512967586517334, 0.7461321353912354, 0.6911196708679199, 0.8029005527496338]

# tpch sf 10, cluster indices
build_time = [320.8378908634186, 165.93383145332336, 216.74489545822144, 151.45674443244934, 230.87265419960022,
              377.00056052207947, 208.42888879776, 244.19388842582703, 184.10594964027405, 181.24464106559753,
              183.33733987808228, 223.99234461784363, 216.3085732460022, 249.73732733726501, 149.2245650291443,
              165.98714900016785, 156.94260334968567, 193.74639081954956, 286.70338916778564, 50.13511538505554,
              53.731343507766724, 50.83751893043518, 44.389347314834595, 15.233500957489014, 49.13466739654541,
              0.32523393630981445, 4.257875442504883, 6.664344549179077, 5.943871736526489, 15.232544422149658,
              10.171169996261597, 10.731101751327515, 10.306408882141113, 18.725948095321655, 95.36216402053833,
              29.47727394104004, 38.507526874542236, 29.480833530426025, 88.40108156204224, 40.493276834487915,
              94.1030502319336, 30.192981719970703, 33.13226890563965, 0.009006500244140625, 0.006581544876098633,
              0.007934093475341797, 0.007856369018554688, 6.1734607219696045, 3.1071243286132812, 4.5512518882751465,
              6.445391416549683, 7.8589818477630615, 11.047771215438843, 8.070224046707153, 4.281203508377075,
              3.852756977081299, 3.656109094619751, 2.99562931060791, 3.925333261489868]



# sf10 drop time, uncluster indices
# drop_time = [0.07919692993164062, 0.07542967796325684, 0.07498455047607422, 0.06668281555175781, 0.05577969551086426,
#              0.05391812324523926, 0.056562185287475586, 0.06014060974121094, 0.05572986602783203, 0.05587935447692871,
#              0.056078433990478516, 0.08062958717346191, 0.12244033813476562, 0.05679655075073242, 0.06293296813964844,
#              0.05570244789123535, 0.05623769760131836, 0.05576276779174805, 0.09521079063415527, 0.013185739517211914,
#              0.008985519409179688, 0.009376287460327148, 0.008896827697753906, 0.009997844696044922,
#              0.009177446365356445, 0.0016322135925292969, 0.004549741744995117, 0.005369663238525391,
#              0.012881040573120117, 0.005287885665893555, 0.003991842269897461, 0.004084110260009766,
#              0.006069183349609375, 0.006763935089111328, 0.01683497428894043, 0.015717744827270508, 0.01574540138244629,
#              0.017798662185668945, 0.0206148624420166, 0.02067708969116211, 0.015578985214233398, 0.020496129989624023,
#              0.020802974700927734, 0.0009059906005859375, 0.0005292892456054688, 0.0011754035949707031,
#              0.0011897087097167969, 0.006396055221557617, 0.0031282901763916016, 0.003946781158447266,
#              0.003856182098388672, 0.0036203861236572266, 0.0049419403076171875, 0.00576019287109375,
#              0.00588679313659668, 0.004491329193115234, 0.004378318786621094, 0.004461526870727539,
#              0.006210803985595703]



# sf10 drop time
drop_time = [0.0785062313079834, 0.07359170913696289, 0.0846853256225586, 0.05315399169921875, 0.05418276786804199,
             1.265376091003418, 0.05528116226196289, 0.057128190994262695, 0.052973031997680664, 0.054183244705200195,
             0.055664777755737305, 0.07330060005187988, 0.1233968734741211, 0.05462789535522461, 0.05446648597717285,
             0.05221962928771973, 0.05441999435424805, 0.07411813735961914, 0.07627630233764648, 0.012898445129394531,
             0.008047103881835938, 0.007960081100463867, 0.008998870849609375, 0.007882118225097656,
             0.007938146591186523, 0.0010068416595458984, 0.004205942153930664, 0.004006862640380859,
             0.004508495330810547, 0.0048067569732666016, 0.002587556838989258, 0.003187417984008789,
             0.0031659603118896484, 0.005105495452880859, 0.017505645751953125, 0.013845682144165039,
             0.014017105102539062, 0.015645742416381836, 0.019463300704956055, 0.019488811492919922, 0.3698697090148926,
             0.019521236419677734, 0.021226882934570312, 0.0008068084716796875, 0.0007386207580566406,
             0.0007932186126708984, 0.0007793903350830078, 0.0019659996032714844, 0.0019817352294921875,
             0.0025539398193359375, 0.001983642578125, 0.0020890235900878906, 0.002475261688232422,
             0.0036537647247314453, 0.003046274185180664, 0.003636598587036133, 0.003270387649536133,
             0.002611875534057617, 0.0037775039672851562]


# sf 10 micro episode
# micro_performance = [
#     114.47336292266846, 22.822721481323242, 40.04279351234436, 44.44095516204834, 8.901808023452759,
#     2.373818874359131, 12.24013066291809, 11.059002876281738, 26.258662462234497, 21.80778431892395, 26.18614959716797,
#     22.242018699645996, 24.814265966415405, 32.31500005722046, 115.3176257610321, 37.33033895492554, 72.641676902771,
#     32.324278593063354, 72.32755136489868, 41.424108266830444, 47.23101592063904, 53.33552813529968, 33.58227825164795,
#     39.34899854660034, 67.47591495513916, 72.32272529602051, 70.30185651779175, 68.60475850105286, 48.335402727127075,
#     122.66358423233032, 50.11123275756836, 36.55921459197998, 43.24441361427307, 106.71828746795654, 19.173505783081055,
#     23.130651473999023, 63.35856914520264, 196.03630995750427, 39.62780165672302, 160.66970920562744, 62.63727045059204,
#     20.254565238952637, 68.18759512901306, 37.56788992881775, 37.458152055740356, 63.362956047058105, 33.68816566467285,
#     34.35945916175842, 33.19725823402405, 95.65305399894714, 94.67435765266418, 174.38359189033508, 150.58328437805176,
#     86.1374306678772, 106.53880548477173, 14.236620664596558, 201.70608401298523, 109.26505255699158,
#     37.550796031951904, 62.81232213973999, 99.99666666984558, 71.2736463546753, 167.35409116744995, 76.5071918964386,
#     19.960180521011353, 29.65361714363098, 52.60288453102112, 54.1838264465332, 61.69336485862732, 44.587135553359985,
#     30.654902696609497, 51.819666624069214, 32.99088430404663, 54.72185444831848, 58.398016691207886, 96.68806719779968,
#     41.093236446380615, 96.96005988121033, 37.36451530456543, 81.7955551147461, 79.01566815376282, 124.90081548690796,
#     96.6200909614563, 50.550719261169434, 50.670389890670776, 313.78045320510864, 85.12522530555725, 105.27627396583557,
#     121.89705014228821, 102.80671811103821, 67.14997887611389, 53.56398677825928, 52.802539110183716, 70.63430905342102,
#     59.69525980949402, 99.24634552001953, 65.9663987159729, 72.43643164634705, 133.90995502471924, 88.40428638458252,
#     329.4300146102905, 46.81181025505066, 97.12928009033203, 109.53900957107544, 45.216272592544556, 45.99284791946411,
#     19.608211278915405, 45.420408964157104, 35.38689041137695, 59.52835178375244, 143.2055459022522, 112.11907410621643,
#     48.14239048957825, 15.031264543533325, 113.17799735069275, 43.945435762405396, 36.757169008255005,
#     82.67228722572327, 55.744072675704956, 88.10577487945557, 98.6204764842987, 88.77343010902405, 43.69371032714844,
#     54.52925372123718, 80.13848614692688, 133.27485918998718, 42.228482484817505, 129.79122161865234, 56.45089507102966,
#     70.50044798851013, 48.272599935531616, 29.832420349121094, 53.650667905807495, 42.06800103187561,
#     299.87283086776733, 40.05599069595337, 27.094340324401855, 50.235286235809326, 288.30050444602966, 62.9773530960083,
#     72.73594093322754, 136.92281222343445, 191.55818033218384, 113.36353516578674, 23.6629159450531, 26.409149408340454,
#     292.34998965263367, 70.64243507385254, 24.412833213806152, 52.1815824508667, 55.861095905303955, 52.990949630737305,
#     70.69757604598999, 33.17081022262573, 29.63575315475464, 24.904253482818604, 40.05564880371094, 41.466286182403564,
#     58.84926509857178, 56.07525634765625, 60.739532232284546, 29.946566581726074, 45.476264238357544,
#     36.447346687316895, 31.39885115623474, 49.082648277282715, 290.00896072387695, 53.9082989692688, 76.4225640296936,
#     291.34055495262146, 33.23553276062012, 49.07512307167053, 51.45026397705078, 39.794167280197144, 18.451571464538574,
#     12.727158784866333, 11.56954312324524, 14.67131495475769, 21.221746683120728, 79.91812658309937, 88.56648182868958,
#     34.324825048446655, 70.16097521781921, 81.881991147995, 30.15341019630432, 36.21904420852661, 56.57346796989441,
#     155.0525860786438, 137.59361171722412, 540.9178335666656, 75.9085578918457, 187.48713517189026, 76.39505457878113,
#     155.40535736083984, 58.3410267829895, 54.73784613609314, 43.976826429367065, 46.49887180328369, 44.422521114349365,
#     75.2874391078949, 57.5843505859375, 162.12405586242676, 198.47190952301025, 109.0450325012207, 178.26481747627258,
#     78.75720810890198, 87.87826728820801, 33.72382044792175, 111.70773816108704, 152.4412806034088, 117.00777769088745,
#     81.89557075500488, 68.41015625, 74.09537696838379, 116.30052447319031, 44.01719069480896, 42.580156087875366,
#     60.19665741920471, 272.71622252464294, 9.733405113220215, 14.531643390655518, 22.473384380340576,
#     244.09134888648987, 25.78790044784546, 43.91675806045532, 280.2765338420868, 80.51967263221741, 27.95958662033081,
#     45.97483706474304, 49.596171140670776, 52.99428677558899, 61.767720222473145, 210.94879865646362,
#     152.13955068588257, 1002.956244468689, 68.03703761100769, 65.57503414154053, 22.027015686035156, 250.471595287323,
#     114.56748628616333, 100.51455998420715, 94.92157578468323, 41.563451528549194, 54.37359356880188,
#     53.584882974624634, 68.58937335014343, 68.14840793609619, 143.9392955303192, 126.93821239471436, 78.74093437194824,
#     99.65048837661743, 119.60045862197876, 93.68006753921509, 110.58411192893982, 10.33264708518982, 10.299779653549194,
#     49.93865418434143, 37.510868310928345, 19.452954530715942, 103.82789778709412, 124.1114935874939, 138.1923975944519,
#     114.39806365966797, 55.02388858795166, 12.112173557281494, 11.950136184692383, 1.4226548671722412,
#     28.476666927337646, 30.680744647979736, 100.34100222587585, 159.70185208320618, 43.51746082305908,
#     61.60107135772705, 80.86856460571289, 408.045912027359, 117.88816571235657, 26.309633255004883, 214.62527585029602,
#     69.35652756690979, 63.5786190032959, 293.51624608039856, 63.96762180328369, 102.8970456123352, 45.68992567062378,
#     66.3381118774414, 120.83920431137085, 42.15668082237244, 17.995803594589233, 46.38188171386719, 210.1629250049591,
#     150.2891709804535, 115.55949974060059, 79.04274225234985, 99.75473880767822, 26.42772626876831, 33.4569947719574,
#     20.723310708999634, 9.589348554611206, 29.476266384124756, 74.33058857917786, 85.11848449707031, 120.89280819892883,
#     43.70060873031616, 350.5906376838684, 40.14321684837341, 82.80452394485474, 57.05193638801575, 50.68238353729248,
#     569.7161889076233, 107.22073435783386, 122.78654766082764, 135.920019865036, 30.68081784248352, 105.77106857299805
# ]


# sf 10, non cluster indices
micro_performance = [53.236709117889404, 34.13613486289978, 48.2559974193573, 57.779754400253296, 41.58331823348999,
                     53.73397088050842, 50.77145743370056, 97.53761124610901, 34.14732217788696, 72.3901207447052,
                     101.00258779525757, 122.47698426246643, 58.947293281555176, 28.11352014541626, 54.11649799346924,
                     24.52357244491577, 34.13395309448242, 62.380417346954346, 34.96059799194336, 23.60808491706848,
                     18.858235120773315, 44.343976736068726, 32.56995987892151, 33.29722619056702, 43.241732597351074,
                     11.232566595077515, 17.656360387802124, 28.411774158477783, 7.06281304359436, 11.552535772323608,
                     35.82431936264038, 34.95539736747742, 59.00883674621582, 54.001962661743164, 45.058703660964966,
                     69.00693225860596, 70.33076858520508, 62.050095558166504, 64.69269490242004, 55.5506386756897,
                     90.04121804237366, 33.08114790916443, 70.86770224571228, 78.57832980155945, 56.530142068862915,
                     35.13577175140381, 139.97792768478394, 200.51031804084778, 72.6379497051239, 81.1318097114563,
                     92.22025847434998, 171.75942063331604, 79.75169134140015, 26.70658278465271, 206.1872148513794,
                     26.173360109329224, 40.429961919784546, 51.24294710159302, 24.48036003112793, 11.579494714736938,
                     33.29357099533081, 49.2028706073761, 40.31429672241211, 17.046301126480103, 56.908371686935425,
                     53.535656213760376, 91.24110150337219, 42.744197607040405, 32.56442070007324, 381.6009593009949,
                     63.443930864334106, 84.48719334602356, 33.07695007324219, 80.41327214241028, 33.082890033721924,
                     5.851960897445679, 6.778276681900024, 27.789285898208618, 20.178529024124146, 28.708199739456177,
                     119.6052508354187, 52.190404415130615, 64.7303581237793, 121.27003955841064, 55.4967827796936,
                     71.53821754455566, 56.38746428489685, 114.8580470085144, 57.53123879432678, 57.37183880805969,
                     55.599647998809814, 61.49105525016785, 43.094382762908936, 70.79065275192261, 85.8746542930603,
                     23.979918003082275, 46.65523409843445, 47.81373834609985, 39.06101870536804, 44.36592650413513,
                     111.38581275939941, 86.86138272285461, 236.19302940368652, 188.13908791542053, 46.44522261619568,
                     72.52716660499573, 63.03337264060974, 169.30010199546814, 96.23769211769104, 70.30670404434204,
                     43.66075849533081, 166.27580857276917, 308.92078495025635, 76.99223947525024, 235.13422751426697,
                     88.03937125205994, 121.85840559005737, 51.85032105445862, 59.44157862663269, 64.02453565597534,
                     32.71664547920227, 24.09139323234558, 10.455779314041138, 21.37498712539673, 20.41267704963684,
                     30.79975175857544, 55.40687298774719, 77.03485703468323, 62.52442145347595, 40.654717206954956,
                     83.65355372428894, 73.4809889793396, 55.297943353652954, 113.64067387580872, 191.07877159118652,
                     70.50191974639893, 78.73565220832825, 47.00679326057434, 217.2874255180359, 29.332388639450073,
                     35.32487344741821, 69.08752751350403, 116.57956671714783, 37.89738154411316, 78.34983801841736,
                     49.159188747406006, 62.63797736167908, 59.62854743003845, 70.19318079948425, 37.14128804206848,
                     84.02610754966736, 28.535701751708984, 16.93485927581787, 21.771469593048096, 47.0592098236084,
                     78.40563106536865, 41.33723425865173, 105.5159285068512, 80.10130834579468, 48.50004005432129,
                     79.23444676399231, 64.49714922904968, 91.49289894104004, 88.75997757911682, 110.9721143245697,
                     46.805302143096924, 95.71419048309326, 91.23862361907959, 65.7632212638855, 45.46874213218689,
                     43.32539653778076, 36.510857582092285, 94.98453760147095, 61.11922597885132, 15.759318590164185,
                     180.9761197566986, 65.14713048934937, 36.9135057926178, 346.56989192962646, 46.88828802108765,
                     252.05818843841553, 104.937575340271, 212.59145140647888, 10.065321922302246, 35.88573932647705,
                     11.754213333129883, 17.539072036743164, 13.324832201004028, 12.692702770233154, 14.436893701553345,
                     69.47315502166748, 89.76911783218384, 189.59296774864197, 112.35006928443909, 55.501941204071045,
                     138.82118105888367, 271.129812002182, 125.95256185531616, 144.72982931137085, 220.46088123321533,
                     42.40893316268921, 17.50240182876587, 24.218873262405396, 63.09160757064819, 17.09273886680603,
                     58.01550555229187, 70.46257185935974, 94.87593603134155, 108.32206678390503, 79.54771995544434,
                     13.112203598022461, 35.74350452423096, 55.312737464904785, 61.697911739349365, 57.025720834732056,
                     1.252504587173462, 3.1960952281951904, 3.1960952281951904, 3.1960952281951904, 3.1960952281951904,
                     48.82307147979736, 34.41127347946167, 25.30407977104187]

terminate_action = 59

index_card_info = list(map(lambda x: x[4], index.candidate_indices))


def cost(configurations, evaluated_order):
    save_cost = 0
    for i in range(1, len(evaluated_order)):
        evaluate_unit = evaluated_order[i]
        prev_evaluate_unit = evaluated_order[i - 1]
        save_config = set(configurations[prev_evaluate_unit]) & (set(configurations[evaluate_unit]))
        save_cost += sum(build_time[action] + drop_time[action] for action in save_config)
    return save_cost


optimizer = order_optimizer.OrderOptimizer(build_time)

micro_duration = 5

macro_episode = int(len(micro_performance) / micro_duration)

delay_time = macro_episode

t1 = 0

noreorder_total_saving = 0
reorder_total_saving = 0

noreorder_idx_cost = 0
reorder_idx_cost = 0

noreorder_total_cost = 0
reorder_total_cost = 0
total_evaluate_time = 0

noreorder_total_costs = []
reorder_total_costs = []

while t1 < macro_episode - 1:
    selected_heavy_action_batch = []
    for d in range(delay_time):
        if t1 + d < macro_episode:
            selected_heavy_actions = list(filter(lambda x: x != terminate_action, log[t1 + d]))
            selected_heavy_action_batch.append(selected_heavy_actions)
        else:
            break
    # show those actions
    evaluated_order = optimizer.min_cost_order(selected_heavy_action_batch)
    # print("evaluated_order:", evaluated_order)
    noreorder_save_cost = cost(selected_heavy_action_batch, range(0, d))
    reorder_save_cost = cost(selected_heavy_action_batch, evaluated_order)
    # print("noreorder_save_cost", noreorder_save_cost)
    # print("reorder_save_cost", reorder_save_cost)

    noreorder_total_saving += noreorder_save_cost
    reorder_total_saving += reorder_save_cost
    total_cost = 0
    for i in range(d + 1):
        total_cost += sum(build_time[action] + drop_time[action] for action in selected_heavy_action_batch[i])
    evaluate_time = 0
    for i in range(d + 1):
        for j in range(micro_duration):
            current_visit = (t1 + i) * micro_duration + j
            # print("current_visit", current_visit)
            evaluate_time += micro_performance[current_visit]
    noreorder_total_cost += total_cost - noreorder_save_cost + evaluate_time
    reorder_total_cost += total_cost - reorder_save_cost + evaluate_time
    noreorder_idx_cost += total_cost - noreorder_save_cost
    reorder_idx_cost += total_cost - reorder_save_cost

    # print("evaluate_time", evaluate_time)
    # print("cost", total_cost - noreorder_save_cost)
    t1 += delay_time

    total_evaluate_time += evaluate_time

    print("total evaluate time:", total_evaluate_time)
    #
    print("noreorder_total_saving", noreorder_total_saving)
    print("reorder_total_saving", reorder_total_saving)

    print("noreorder_index_cost", noreorder_idx_cost)
    print("reorder_index_cost", reorder_idx_cost)

    print("noreorder_total_cost", noreorder_total_cost)
    print("reorder_total_cost", reorder_total_cost)

    noreorder_total_costs.append(noreorder_total_cost)
    reorder_total_costs.append(reorder_total_cost)

for noreorder_total_cost in noreorder_total_costs:
    print(noreorder_total_cost)

print("=====")
for reorder_total_cost in reorder_total_costs:
    # print()
    # print()
    # print()
    # print()
    # print()
    # print()
    # print()
    # print()
    print()
    print()
    print()
    print(reorder_total_cost)


# the online approach
# pending_actions = []
# pending_actions_time = set()
#
# while t1 < macro_episode:
#     # get the selected heavy configurations, and prune the terminate action
#     selected_heavy_actions = list(filter(lambda x: x != terminate_action, log[t1]))
#     pending_actions.append((t1, selected_heavy_actions))
#     pending_actions_time.add(t1)
#     if (t1 - delay_time) in pending_actions_time:
#         # have to evaluate the configuration generated at t1 - delay_time
#         actions_to_evaluate = []
#         actions_to_evaluate.append(selected_heavy_actions[0])
#         for i in range(1, len(pending_actions)):
#             # calculate cost for other actions
#             pending_action = pending_actions[i]
